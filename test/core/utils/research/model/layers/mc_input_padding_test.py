import unittest

import torch

from core.utils.research.model.layers import MCInputPadding


class MCInputPaddingTest(unittest.TestCase):

	def setUp(self):
		self.layer = MCInputPadding(channels=(1, 2))

	def test_call(self):
		x = torch.Tensor([
			[[0.2570, 0.8074, 0.1057, 0.1110, 0.4168, 0.0494, 0.0365, 0.0055,
          0.3611, 0.3981],
			[0.7018, 0.7683, 0.9204, 0.8591, 0.1916, 0.8563, 0.9880, 0.0000,
			0.0000, 0.0000],
			[0.2743, 0.6303, 0.6029, 0.9130, 0.6331, 0.7890, 0.4845, 0.0000,
			0.0000, 0.0000]],
			[[0.8279, 0.8516, 0.0240, 0.1824, 0.4025, 0.5732, 0.1617, 0.0603,
			0.9868, 0.6175],
			[0.3704, 0.4011, 0.0273, 0.7877, 0.3577, 0.0404, 0.7964, 0.0000,
			0.0000, 0.0000],
			[0.1538, 0.5356, 0.7835, 0.7120, 0.6680, 0.4595, 0.0019, 0.0000,
			0.0000, 0.0000]],
			[[0.2595, 0.3845, 0.5711, 0.0294, 0.1081, 0.0455, 0.5544, 0.2318,
			0.2632, 0.8493],
			[0.3688, 0.0389, 0.1363, 0.3730, 0.6315, 0.7162, 0.1130, 0.0000,
			0.0000, 0.0000],
			[0.4708, 0.6381, 0.3019, 0.2296, 0.9449, 0.5846, 0.8761, 0.0000,
			0.0000, 0.0000]],
			[[0.6892, 0.6540, 0.3834, 0.1808, 0.9373, 0.8355, 0.7689, 0.8643,
			0.4791, 0.4227],
			[0.1560, 0.2681, 0.0837, 0.8058, 0.6649, 0.7077, 0.9641, 0.0000,
			0.0000, 0.0000],
			[0.0982, 0.0250, 0.2241, 0.8279, 0.8765, 0.3648, 0.5351, 0.0000,
			0.0000, 0.0000]],
			[[0.6929, 0.9277, 0.8635, 0.5427, 0.9527, 0.2632, 0.9224, 0.8063,
			0.0736, 0.8429],
			[0.6133, 0.5990, 0.6212, 0.6965, 0.8466, 0.5356, 0.9850, 0.0000,
			0.0000, 0.0000],
			[0.1477, 0.9453, 0.6472, 0.7872, 0.1604, 0.5556, 0.1710, 0.0000,
			0.0000, 0.0000]]
		])

		y = torch.Tensor([
			[[0.2570, 0.8074, 0.1057, 0.1110, 0.4168, 0.0494, 0.0365, 0.0055, 0.3611, 0.3981],
			 [0.7018, 0.7683, 0.9204, 0.8591, 0.1916, 0.8563, 0.9880, 0.9880, 0.9880, 0.9880],
			 [0.2743, 0.6303, 0.6029, 0.9130, 0.6331, 0.7890, 0.4845, 0.4845, 0.4845, 0.4845]],

			[[0.8279, 0.8516, 0.0240, 0.1824, 0.4025, 0.5732, 0.1617, 0.0603, 0.9868, 0.6175],
			 [0.3704, 0.4011, 0.0273, 0.7877, 0.3577, 0.0404, 0.7964, 0.7964, 0.7964, 0.7964],
			 [0.1538, 0.5356, 0.7835, 0.7120, 0.6680, 0.4595, 0.0019, 0.0019, 0.0019, 0.0019]],

			[[0.2595, 0.3845, 0.5711, 0.0294, 0.1081, 0.0455, 0.5544, 0.2318, 0.2632, 0.8493],
			 [0.3688, 0.0389, 0.1363, 0.3730, 0.6315, 0.7162, 0.1130, 0.1130, 0.1130, 0.1130],
			 [0.4708, 0.6381, 0.3019, 0.2296, 0.9449, 0.5846, 0.8761, 0.8761, 0.8761, 0.8761]],

			[[0.6892, 0.6540, 0.3834, 0.1808, 0.9373, 0.8355, 0.7689, 0.8643, 0.4791, 0.4227],
			 [0.1560, 0.2681, 0.0837, 0.8058, 0.6649, 0.7077, 0.9641, 0.9641, 0.9641, 0.9641],
			 [0.0982, 0.0250, 0.2241, 0.8279, 0.8765, 0.3648, 0.5351, 0.5351, 0.5351, 0.5351]],

			[[0.6929, 0.9277, 0.8635, 0.5427, 0.9527, 0.2632, 0.9224, 0.8063, 0.0736, 0.8429],
			 [0.6133, 0.5990, 0.6212, 0.6965, 0.8466, 0.5356, 0.9850, 0.9850, 0.9850, 0.9850],
			 [0.1477, 0.9453, 0.6472, 0.7872, 0.1604, 0.5556, 0.1710, 0.1710, 0.1710, 0.1710]]
		])

		with torch.no_grad():
			y_hat = self.layer(x)

		self.assertTrue(torch.all(y_hat == y))
